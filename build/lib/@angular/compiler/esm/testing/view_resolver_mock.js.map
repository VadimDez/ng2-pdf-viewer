{"version":3,"file":"view_resolver_mock.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/testing/view_resolver_mock.ts"],"names":[],"mappings":"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","sourcesContent":["import {AnimationEntryMetadata, BaseException, Injectable, Type, ViewMetadata, resolveForwardRef} from '@angular/core';\n\nimport {ViewResolver} from '../index';\nimport {Map} from '../src/facade/collection';\nimport {isArray, isBlank, isPresent, stringify} from '../src/facade/lang';\nexport class MockViewResolver extends ViewResolver {\n  /** @internal */\n  _views = new Map<Type, ViewMetadata>();\n  /** @internal */\n  _inlineTemplates = new Map<Type, string>();\n  /** @internal */\n  _animations = new Map<Type, AnimationEntryMetadata[]>();\n  /** @internal */\n  _viewCache = new Map<Type, ViewMetadata>();\n  /** @internal */\n  _directiveOverrides = new Map<Type, Map<Type, Type>>();\n\n  constructor() { super(); }\n\n  /**\n   * Overrides the {@link ViewMetadata} for a component.\n   */\n  setView(component: Type, view: ViewMetadata): void {\n    this._checkOverrideable(component);\n    this._views.set(component, view);\n  }\n  /**\n   * Overrides the inline template for a component - other configuration remains unchanged.\n   */\n  setInlineTemplate(component: Type, template: string): void {\n    this._checkOverrideable(component);\n    this._inlineTemplates.set(component, template);\n  }\n\n  setAnimations(component: Type, animations: AnimationEntryMetadata[]): void {\n    this._checkOverrideable(component);\n    this._animations.set(component, animations);\n  }\n\n  /**\n   * Overrides a directive from the component {@link ViewMetadata}.\n   */\n  overrideViewDirective(component: Type, from: Type, to: Type): void {\n    this._checkOverrideable(component);\n\n    var overrides = this._directiveOverrides.get(component);\n\n    if (isBlank(overrides)) {\n      overrides = new Map<Type, Type>();\n      this._directiveOverrides.set(component, overrides);\n    }\n\n    overrides.set(from, to);\n  }\n\n  /**\n   * Returns the {@link ViewMetadata} for a component:\n   * - Set the {@link ViewMetadata} to the overridden view when it exists or fallback to the default\n   * `ViewResolver`,\n   *   see `setView`.\n   * - Override the directives, see `overrideViewDirective`.\n   * - Override the @View definition, see `setInlineTemplate`.\n   */\n  resolve(component: Type): ViewMetadata {\n    var view = this._viewCache.get(component);\n    if (isPresent(view)) return view;\n\n    view = this._views.get(component);\n    if (isBlank(view)) {\n      view = super.resolve(component);\n    }\n\n    var directives: any[] /** TODO #9100 */ = [];\n    if (isPresent(view.directives)) {\n      flattenArray(view.directives, directives);\n    }\n    var animations = view.animations;\n    var templateUrl = view.templateUrl;\n    var overrides = this._directiveOverrides.get(component);\n\n    var inlineAnimations = this._animations.get(component);\n    if (isPresent(inlineAnimations)) {\n      animations = inlineAnimations;\n    }\n\n    var inlineTemplate = this._inlineTemplates.get(component);\n    if (isPresent(inlineTemplate)) {\n      templateUrl = null;\n    } else {\n      inlineTemplate = view.template;\n    }\n\n    if (isPresent(overrides) && isPresent(view.directives)) {\n      overrides.forEach((to, from) => {\n        var srcIndex = directives.indexOf(from);\n        if (srcIndex == -1) {\n          throw new BaseException(\n              `Overriden directive ${stringify(from)} not found in the template of ${stringify(component)}`);\n        }\n        directives[srcIndex] = to;\n      });\n    }\n\n    view = new ViewMetadata({\n      template: inlineTemplate,\n      templateUrl: templateUrl,\n      directives: directives.length > 0 ? directives : null,\n      animations: animations,\n      styles: view.styles,\n      styleUrls: view.styleUrls,\n      pipes: view.pipes,\n      encapsulation: view.encapsulation\n    });\n\n    this._viewCache.set(component, view);\n    return view;\n  }\n\n  /**\n   * @internal\n   *\n   * Once a component has been compiled, the AppProtoView is stored in the compiler cache.\n   *\n   * Then it should not be possible to override the component configuration after the component\n   * has been compiled.\n   */\n  _checkOverrideable(component: Type): void {\n    var cached = this._viewCache.get(component);\n\n    if (isPresent(cached)) {\n      throw new BaseException(\n          `The component ${stringify(component)} has already been compiled, its configuration can not be changed`);\n    }\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n];\n}\n\nfunction flattenArray(tree: any[], out: Array<Type|any[]>): void {\n  if (!isPresent(tree)) return;\n  for (var i = 0; i < tree.length; i++) {\n    var item = resolveForwardRef(tree[i]);\n    if (isArray(item)) {\n      flattenArray(item, out);\n    } else {\n      out.push(item);\n    }\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}